{% extends "layout/base.html" %}
{% block title %}Manage Users{% endblock %}

{% block content %}
<div class="container py-4">
  <!-- Professional Header -->
  <div class="page-header mb-4">
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
      <div>
        <h2 class="gradient-text mb-0"><i class="fas fa-users-cog"></i> Staff Management</h2>
        <p class="text-muted mb-0 mt-1">Manage your team accounts and permissions</p>
      </div>
      <a href="{{ url_for('register_staff') }}" class="btn btn-success pulse-btn">
        <i class="fas fa-user-plus"></i> Add New Staff
      </a>
    </div>
  </div>

  <!-- Search Bar -->
  <div class="card glass-card p-3 mb-4">
    <form method="GET" action="{{ url_for('search_users') }}" class="row g-2 align-items-center">
      <div class="col-md-10">
        <div class="input-group">
          <span class="input-group-text bg-glass">
            <i class="fas fa-search"></i>
          </span>
          <input type="text" name="query" class="form-control" 
                 placeholder="Search by name, username, email or department..." 
                 value="{{ search_query if search_query else '' }}">
        </div>
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100">
          <i class="fas fa-filter"></i> Search
        </button>
      </div>
    </form>
  </div>

  <!-- Users List -->
  {% if users %}
    <div class="users-grid">
      {% for user in users %}
        <div class="user-card-wrapper" data-user-id="{{ user.id }}" 
             data-username="{{ user.username }}">
          <div class="card glass-card h-100 user-card">
            <div class="card-header bg-transparent d-flex justify-content-between align-items-center">
              <div>
                
                <h6 class="mb-0 gradient-text">
                  {{ user.first_name }}{% if user.middle_name %} {{ user.middle_name }}{% endif %} {{ user.last_name }}
                </h6>
                <small class="text-muted">@{{ user.username }}</small>
              </div>
              <span class="status-badge {% if user.is_active %}active{% else %}inactive{% endif %}">
                <i class="fas fa-circle"></i>
              </span>
            </div>
            
            <div class="card-body">
              <div class="user-details">
                <div class="detail-item">
                  <i class="fas fa-envelope text-muted"></i>
                  <span class="truncate">{{ user.email }}</span>
                </div>
                <div class="detail-item">
                  <i class="fas fa-phone text-muted"></i>
                  <span>{{ user.phone or 'N/A' }}</span>
                </div>
                <div class="detail-item">
                  <i class="fas fa-building text-muted"></i>
                  <span class="badge bg-info">{{ user.department }}</span>
                </div>
                <div class="detail-item">
                  <i class="fas fa-calendar text-muted"></i>
                  <small class="text-muted">Joined: {{ user.created_at|manila_time }}</small>
                </div>
                {% if user.must_change_password %}
                  <div class="detail-item">
                    <i class="fas fa-exclamation-triangle text-warning"></i>
                    <small class="text-warning">Password reset required</small>
                  </div>
                {% endif %}
              </div>
            </div>
            
            <div class="card-footer bg-transparent border-0">
              <div class="action-buttons">
                <button class="btn btn-glass btn-sm delete-btn">
                  <i class="fas fa-trash"></i> Delete
                </button>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <!-- Empty State -->
    <div class="text-center py-5">
      <div class="icon-circle mx-auto mb-3" style="width: 120px; height: 120px;">
        <i class="fas fa-users fa-3x gradient-text" style="opacity: 0.3;"></i>
      </div>
      <h5 class="text-muted mb-3">No Staff Accounts Found</h5>
      <p class="text-muted">
        {% if search_query %}No results for "{{ search_query }}"{% else %}Get started by adding your first staff member.{% endif %}
      </p>
      <a href="{{ url_for('register_staff') }}" class="btn btn-success mt-2">
        <i class="fas fa-user-plus"></i> Add First Staff
      </a>
    </div>
  {% endif %}

  <!-- Back Button -->
  <div class="text-center mt-4">
    <a href="{{ url_for('admin_dashboard') }}" class="btn btn-glass">
      <i class="fas fa-arrow-left"></i> Back to Dashboard
    </a>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Delete button handler
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.delete-btn').forEach(button => {
    button.addEventListener('click', function() {
      const cardWrapper = this.closest('.user-card-wrapper');
      const userId = cardWrapper.dataset.userId;
      const username = cardWrapper.dataset.username;
      
      // Simple confirmation (you can upgrade to modal later)
      if (confirm(`ðŸš¨ Delete user @${username}? This cannot be undone!`)) {
        window.location.href = `/delete_user/${userId}`;
      }
    });
  });
});
</script>
{% endblock %}