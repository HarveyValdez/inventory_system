{% extends 'layout/base.html' %}
{% block title %}Footwear Inventory{% endblock %}
{% block content %}

<div class="container mt-4">
  <h2 class="mb-4 text-center">ðŸ‘Ÿ Footwear Inventory</h2>

  <!-- Search Bar -->
  <form method="GET" action="{{ url_for('index') }}" class="d-flex mb-3">
    <input type="text" name="query" class="form-control me-2" placeholder="Search footwear..." 
           value="{{ search_query if search_query else '' }}">
    <button type="submit" class="btn btn-outline-primary">Search</button>
  </form>

  <!-- Add Product Button (Admins only) -->
  {% if session['role'] == 'admin' %}
  <div class="text-end mb-3">
    <a href="{{ url_for('add_product') }}" class="btn btn-success">
      âž• Add New Footwear
    </a>
  </div>
  {% endif %}

  <!-- Product Table -->
  <table class="table table-striped align-middle">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Photo</th>
        <th>Name</th>
        <th>Brand</th>
        <th>Category</th>
        <th>Size</th>
        <th>Stock</th>
        <th>Price (â‚±)</th>
        <th>Date Added</th>
        <th>Time Added</th>
        {% if session['role'] == 'admin' %}
        <th>Actions</th>
        {% endif %}
      </tr>
    </thead>
    <tbody>
      {% for product in products %}
      <tr>
        <td>{{ product.id }}</td>
        <td>
          {% if product.image %}
            <img 
            src="{{ url_for('static', filename='uploads/' + product.image) }}"
            alt="{{ product.name }}"
            class="img-thumbnail shadow-sm"
            style="width:70px; height:70px; object-fit:cover; cursor:pointer; border-radius:10px;"
            data-bs-toggle="modal"
            data-bs-target="#imgModal{{ product.id }}"
          >

          <!-- Image Modal -->
          <div class="modal fade" id="imgModal{{ product.id }}" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
              <div class="modal-content bg-transparent border-0">
                <div class="modal-body text-center p-0">
                  <img 
                    src="{{ url_for('static', filename='uploads/' + product.image) }}"
                    class="img-fluid rounded shadow-lg"
                    style="max-height: 80vh; border-radius: 12px; box-shadow: 0 0 20px rgba(139,233,253,0.4);"
                  >
                </div>
              </div>
            </div>
          </div>


          {% else %}
            <span class="text-muted">No image</span>
          {% endif %}
        </td>
        <td>{{ product.name }}</td>
        <td>{{ product.brand or 'N/A' }}</td>
        <td>{{ product.category or 'N/A' }}</td>
        <td>{{ product.size }} {{ product.size_unit }}</td>
        <td>{{ product.stock }}</td>
        <td>â‚±{{ "%.2f"|format(product.price) }}</td>
        <td>{{ product.date_added }}</td>
        <td>{{ product.time_added.strftime("%H:%M:%S") if product.time_added else '' }}</td>

        {% if session['role'] == 'admin' %}
        <td>
          <a href="{{ url_for('edit_product', id=product.id) }}" class="btn btn-sm btn-warning">Edit</a>
          <a href="{{ url_for('delete_product', id=product.id) }}" 
             class="btn btn-sm btn-danger"
             onclick="return confirm('Are you sure you want to delete this product?')">Delete</a>
        </td>
        {% endif %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
